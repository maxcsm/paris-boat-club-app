"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5331],{5331:(I,m,r)=>{r.r(m),r.d(m,{MapPageModule:()=>M});var f=r(177),u=r(9417),s=r(8974),d=r(904),c=r(467),b=r(7762),v=r(3006),l=r(8244),o=r(4438),y=r(995),g=r(4842);const C=[{path:"",component:(()=>{class a{constructor(t,e,n,i,p,h,k){this.formBuilder=t,this.alertController=e,this.redditService=n,this.router=i,this.modalController=p,this.loadingCtrl=h,this.loadingController=k,this.location=!1,this.role="",this.table="public_locations_short",this.table2="locations",this.status="",this.category=2,this.filter="",this.per_page=100,this.order_id="id",this.order_by="desc",this.page=1}ngAfterViewInit(){this.initializeMap()}ionViewWillEnter(){}initializeMap(){var t=this;return(0,c.A)(function*(){console.log(t.map),t.map&&(t.map.off(),t.map.remove()),t.latposition=48.8582599,t.lngposition=2.2945006,t.map=l.map("map").setView([t.latposition,t.lngposition],16),l.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t.map),yield t.loadingCtrl.create({message:"Chargement..",spinner:"bubbles"}),t.redditService.getDataAll("public_locations_short").subscribe(n=>{t.posts=n.locations,t.posts.forEach(i=>{}),t.loadPoint()})})()}getPositionNew(){var t=this;return(0,c.A)(function*(){const e=yield t.loadingController.create({message:"Recherche localisation"});e.present();const n=yield b.L.getCurrentPosition();console.log("Current position:",n),null!==n.coords.latitude&&(t.latposition=n.coords.latitude,t.lngposition=n.coords.longitude,console.log(t.latposition),console.log(t.lngposition),t.location=!0,setTimeout(()=>{e.dismiss(),l.icon({iconUrl:"./assets/icon/marker-icon.png",iconAnchor:[2,32]}),t.addmarker({lat:t.latposition,lng:t.lngposition})},1e3))})()}leafletMap(){l.icon({iconUrl:"./assets/icon/marker-icon.png",iconAnchor:[60,60]}),this.map=new l.Map("map").setView([this.latposition,this.lngposition],14),l.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{}).addTo(this.map),this.markers=l.layerGroup().addTo(this.map)}loadPoint(){this.posts.forEach(t=>{console.log(t),this.addmarker2(t),console.log("foreatch")})}addmarker(t){console.log(t);var e=l.icon({iconUrl:"./assets/icon/marker-icon.png",iconAnchor:[2,32]});const n=l.marker([t.lat,t.lng],{icon:e});this.map.addLayer(n),this.map.setView([this.latposition,this.lngposition],17)}addmarker2(t){var e=l.icon({iconUrl:"./assets/icon/marker-icon-2.png",iconAnchor:[2,10]});console.log(t);const n=l.marker([t.lat,t.lng],{icon:e});n.bindPopup("<p>"+t.title+'</p><center><ion-button id="popup-button" > Voir  </ion-button>'),this.map.addLayer(n),n.on("click",i=>{const p=document.getElementById("popup-button");p&&p.addEventListener("click",h=>{console.log(h),console.log(t.id),this.idetail=t.id,this.edit(t.id),n.closePopup()})})}edit(t){var e=this;return(0,c.A)(function*(){const n=yield e.modalController.create({component:v.F,componentProps:{paramID:t}});return n.onDidDismiss().then(i=>{null!==i&&(e.modelData=i.data,console.log("Modal Data : "+i.data))}),yield n.present()})()}getdataByid(){var t=this;return(0,c.A)(function*(){console.log("detail event"),t.redditService.getByid(t.table,t.eventid).subscribe(e=>{t.postsevents=e.users,console.log(t.postsevents),t.techs=e.techs,t.appointement=[e.appointement],t.lngevnt=t.techs.lenght})})()}onChangeType(t){this.technicienId=t.target.value}doUpdateAppointement(){var t=this;return(0,c.A)(function*(){var e=JSON.stringify({edited_by:t.technicienId,state:2});yield(yield t.alertController.create({header:"Enregistrement",message:"Voulez-vous vraiment ? ",buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:i=>{}},{text:"Oui",handler:()=>{t.redditService.update(t.table,t.eventid,e).toPromise().then(i=>{setTimeout(()=>{t.getdataByid()},400)})}}]})).present()})()}doFinishedAppointement(){var t=this;return(0,c.A)(function*(){var e=JSON.stringify({state:3});yield(yield t.alertController.create({header:"Enregistrement",message:"Voulez-vous vraiment ? ",buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:i=>{}},{text:"Oui",handler:()=>{t.redditService.update(t.table,t.eventid,e).toPromise().then(i=>{setTimeout(()=>{t.getdataByid()},1e3)})}}]})).present()})()}goList(){this.router.navigateByUrl("/tabs/posts")}static#t=this.\u0275fac=function(e){return new(e||a)(o.rXU(u.ok),o.rXU(s.hG),o.rXU(y.s),o.rXU(d.Ix),o.rXU(s.W3),o.rXU(s.Xi),o.rXU(s.Xi))};static#o=this.\u0275cmp=o.VBU({type:a,selectors:[["app-map"]],decls:17,vars:3,consts:[["color","secondary"],["slot","start"],["slot","primary"],[3,"click"],["name","navigate-circle-outline"],["icon-left","","color","success","expand","full","shape","round","tappable","",2,"text-transform","capitalize",3,"click"],["name","locate-outline"],["id","map"],["vertical","bottom","horizontal","end","slot","fixed",1,"btmap"],["name","list"]],template:function(e,n){1&e&&(o.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),o.nrm(3,"ion-menu-button"),o.k0s(),o.j41(4,"ion-title"),o.EFF(5,"ParisBoatClub "),o.k0s(),o.j41(6,"ion-buttons",2)(7,"ion-button",3),o.bIt("click",function(){return n.getPositionNew()}),o.nrm(8,"ion-icon",4),o.k0s()()()(),o.j41(9,"ion-button",5),o.bIt("click",function(){return n.getPositionNew()}),o.nrm(10,"ion-icon",6),o.EFF(11),o.nI1(12,"translate"),o.k0s(),o.nrm(13,"div",7),o.j41(14,"ion-fab",8)(15,"ion-fab-button",3),o.bIt("click",function(){return n.goList()}),o.nrm(16,"ion-icon",9),o.k0s()()),2&e&&(o.R7$(11),o.SpI(" ",o.bMT(12,1,"myposition")," "))},dependencies:[s.Jm,s.QW,s.Q8,s.YW,s.eU,s.iq,s.MC,s.BC,s.ai,g.D9],styles:["#map[_ngcontent-%COMP%]{height:100vh}.btmap[_ngcontent-%COMP%]{bottom:90px;right:15}"]})}return a})()}];let P=(()=>{class a{static#t=this.\u0275fac=function(e){return new(e||a)};static#o=this.\u0275mod=o.$C({type:a});static#e=this.\u0275inj=o.G2t({imports:[d.iI.forChild(C),d.iI]})}return a})(),M=(()=>{class a{static#t=this.\u0275fac=function(e){return new(e||a)};static#o=this.\u0275mod=o.$C({type:a});static#e=this.\u0275inj=o.G2t({imports:[f.MD,u.YN,s.bv,P,g.h]})}return a})()}}]);