{"ast":null,"code":"import _asyncToGenerator from \"/Users/maxime/Desktop/paris-boat-club-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Geolocation } from '@capacitor/geolocation';\nimport { ModalPostPage } from '../modal-post/modal-post.page';\nimport * as Leaflet from 'leaflet';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@ionic/angular\";\nimport * as i3 from \"src/providers/reddit-service\";\nimport * as i4 from \"@angular/router\";\nexport let EscalesmapPage = /*#__PURE__*/(() => {\n  class EscalesmapPage {\n    constructor(formBuilder, alertController, redditService, router, modalController, loadingCtrl, loadingController) {\n      this.formBuilder = formBuilder;\n      this.alertController = alertController;\n      this.redditService = redditService;\n      this.router = router;\n      this.modalController = modalController;\n      this.loadingCtrl = loadingCtrl;\n      this.loadingController = loadingController;\n      this.location = false;\n      this.role = \"\";\n      this.table = \"public_locations_short\";\n      this.table2 = \"locations\";\n      this.status = \"\";\n      this.category = 2;\n      this.filter = \"\";\n      this.per_page = 100;\n      this.order_id = \"id\";\n      this.order_by = \"desc\";\n      this.page = 1;\n    }\n    ngAfterViewInit() {\n      this.initializeMap();\n    }\n    ionViewWillEnter() {\n      this.initializeMap();\n    }\n    initializeMap() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.latposition = 48.8582599;\n        _this.lngposition = 2.2945006;\n        _this.map = Leaflet.map(\"map\").setView([_this.latposition, _this.lngposition], 16);\n        Leaflet.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n          attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(_this.map);\n        const loading = yield _this.loadingCtrl.create({\n          message: 'Chargement..',\n          spinner: 'bubbles'\n        });\n        _this.redditService.getDataAll(\"public_locations_escales\").subscribe(data => {\n          _this.posts = data.locations;\n          _this.posts.forEach(value => {});\n          //  this.loadPoint();\n        });\n      })();\n    }\n    getPositionNew() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const loader = yield _this2.loadingController.create({\n          message: 'Recherche localisation'\n        });\n        loader.present();\n        const coordinates = yield Geolocation.getCurrentPosition();\n        console.log('Current position:', coordinates);\n        if (coordinates.coords.latitude !== null) {\n          _this2.latposition = coordinates.coords.latitude;\n          _this2.lngposition = coordinates.coords.longitude;\n          console.log(_this2.latposition);\n          console.log(_this2.lngposition);\n          _this2.location = true;\n          setTimeout(() => {\n            loader.dismiss();\n            var startIcon = Leaflet.icon({\n              iconUrl: './assets/icon/marker-icon.png',\n              iconAnchor: [2, 32]\n            });\n            const item = {\n              lat: _this2.latposition,\n              lng: _this2.lngposition\n            };\n            _this2.addmarker(item);\n          }, 1000);\n        }\n      })();\n    }\n    leafletMap() {\n      var startIcon = Leaflet.icon({\n        iconUrl: './assets/icon/marker-icon.png',\n        iconAnchor: [60, 60]\n      });\n      this.map = new Leaflet.Map('map').setView([this.latposition, this.lngposition], 14);\n      Leaflet.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {}).addTo(this.map);\n      //  const markPoint = Leaflet.marker([this.latposition, this.lngposition],{icon: startIcon});\n      //  this.map.addLayer(markPoint);\n      this.markers = Leaflet.layerGroup().addTo(this.map);\n    }\n    loadPoint() {\n      this.posts.forEach(value => {\n        console.log(value);\n        let item = value;\n        this.addmarker2(item);\n        console.log(\"foreatch\");\n      });\n    }\n    /*\n      ngOnDestroy() {\n        this.map.remove();\n      }\n    */\n    addmarker(item) {\n      console.log(item);\n      var startIcon = Leaflet.icon({\n        iconUrl: './assets/icon/marker-icon.png',\n        iconAnchor: [2, 32]\n      });\n      const markPosition = Leaflet.marker([item.lat, item.lng], {\n        icon: startIcon\n      });\n      this.map.addLayer(markPosition);\n      this.map.setView([this.latposition, this.lngposition], 17);\n    }\n    addmarker2(value) {\n      var startIcon = Leaflet.icon({\n        iconUrl: './assets/icon/escale.png',\n        iconAnchor: [2, 10]\n      });\n      console.log(value);\n      const markPoint = Leaflet.marker([value.lat, value.lng], {\n        icon: startIcon\n      });\n      markPoint.bindPopup('<p>' + value.title + '</p>' + '<center><ion-button id=\"popup-button\" > Voir  </ion-button>');\n      this.map.addLayer(markPoint);\n      /*  markPoint.on(\"click\",  (e) => {\n          console.log(e);\n          console.log(value.id);\n                 this.idetail=value.id;\n          this.edit( value.id);\n            });\n           */\n      markPoint.on(\"click\", e => {\n        const button = document.getElementById('popup-button');\n        if (button) {\n          button.addEventListener('click', e => {\n            console.log(e);\n            console.log(value.id);\n            this.idetail = value.id;\n            this.edit(value.id);\n            markPoint.closePopup();\n          });\n        }\n      });\n      /*\n           markPoint.bindPopup(\n           '<p>'+value.title+'</p>'+\n           '<p>'+value.title+'</p>'+\n           '<p>'+value.title+'</p>');\n      \n          this.eventid =value.item ;\n          this.edit(   this.eventid);\n         \n      */\n    }\n    edit(item) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const modal = yield _this3.modalController.create({\n          component: ModalPostPage,\n          componentProps: {\n            \"paramID\": item\n          }\n        });\n        modal.onDidDismiss().then(modelData => {\n          if (modelData !== null) {\n            _this3.modelData = modelData.data;\n            console.log('Modal Data : ' + modelData.data);\n            // this.getdata(); \n          }\n        });\n        return yield modal.present();\n      })();\n    }\n    getdataByid() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        console.log(\"detail event\");\n        _this4.redditService.getByid(_this4.table, _this4.eventid).subscribe(data => {\n          _this4.postsevents = data.users;\n          console.log(_this4.postsevents);\n          _this4.techs = data.techs;\n          _this4.appointement = [data.appointement];\n          _this4.lngevnt = _this4.techs.lenght;\n        });\n      })();\n    }\n    goList() {\n      this.router.navigateByUrl('/tabs/posts');\n    }\n    static #_ = this.ɵfac = function EscalesmapPage_Factory(t) {\n      return new (t || EscalesmapPage)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.AlertController), i0.ɵɵdirectiveInject(i3.RedditService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i2.ModalController), i0.ɵɵdirectiveInject(i2.LoadingController), i0.ɵɵdirectiveInject(i2.LoadingController));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: EscalesmapPage,\n      selectors: [[\"app-escalesmap\"]],\n      decls: 11,\n      vars: 0,\n      consts: [[\"color\", \"secondary\"], [\"slot\", \"start\"], [\"slot\", \"primary\"], [\"id\", \"map\"], [\"vertical\", \"bottom\", \"horizontal\", \"end\", \"slot\", \"fixed\", 1, \"btmap\"], [3, \"click\"], [\"name\", \"list\"]],\n      template: function EscalesmapPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\", 0)(2, \"ion-buttons\", 1);\n          i0.ɵɵelement(3, \"ion-menu-button\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"ion-title\");\n          i0.ɵɵtext(5, \"ParisBoatClub \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(6, \"ion-buttons\", 2);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(7, \"div\", 3);\n          i0.ɵɵelementStart(8, \"ion-fab\", 4)(9, \"ion-fab-button\", 5);\n          i0.ɵɵlistener(\"click\", function EscalesmapPage_Template_ion_fab_button_click_9_listener() {\n            return ctx.goList();\n          });\n          i0.ɵɵelement(10, \"ion-icon\", 6);\n          i0.ɵɵelementEnd()();\n        }\n      },\n      dependencies: [i2.IonButtons, i2.IonFab, i2.IonFabButton, i2.IonHeader, i2.IonIcon, i2.IonMenuButton, i2.IonTitle, i2.IonToolbar],\n      styles: [\"#map[_ngcontent-%COMP%]{height:100vh}.btmap[_ngcontent-%COMP%]{bottom:90px;right:15}\"]\n    });\n  }\n  return EscalesmapPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}